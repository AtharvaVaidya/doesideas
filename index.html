<!DOCTYPE html>  
<html>
<head>
<title>Does Ideas</title>
<meta charset="utf-8" />  
<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/styles.css">
<link rel="stylesheet" href="css/pygment_trac.css">
<link rel="stylesheet" href="css/zenburn.css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.buildr.js"></script>
<script type="text/javascript" src="textile.js"></script>
<script type="text/javascript" src="marked.js"></script>
<script type="text/javascript" src="js/underscore.js"></script>
<script type="text/javascript" src="js/highlight.js"></script>
<script type="text/javascript" src="js/javascript.js"></script>
<script type="text/javascript" src="js/ruby.js"></script>
<script type="text/javascript" src="js/xml.js"></script>
<script type="text/javascript" src="js/scale.fix.js"></script>
<script>hljs.tabReplace = '  ';</script>
<script>

(function(){

  function expandContent(entry){
    entry.date && (entry.formatDate = entry.date);
    _.each(entry, function(value, key){
      entry[key] = (transformations[key] || _.identity)(value);       
    });
    entry.load = function(loaded){
      $.get(entry.source, function(body){
        entry.body = marked.parse(body);
        loaded(entry);
        entry.load = function(loaded){
          loaded(entry);
        }
      })
    }
    entry.date && (entry.year = entry.date.getFullYear());
    entry.slug = (entry.year ? entry.year + '-' : '') + entry.source.split("/")[1].split(".")[0];
    return entry;
  }

  function disqus(entry){

    window.disqus_shortname = 'doesideas';
    window.disqus_identifer = entry.slug;
    window.disqus_url = "http://doesideas.com/#!" + entry.slug;

    if (window.DISQUS) {

      DISQUS.reset({
        reload: true,
        config: function () {  
          //this.page.slug = entry.slug;
          //this.page.developer = 1;
          this.page.title = entry.title;
          this.page.language = "en";       
          this.page.identifier = entry.slug;  
          this.page.url = "http://doesideas.com/#!" + entry.slug;
        }
      });

    } 

  }

  var transformations = {
    date: function(date){
      return new Date(date);
    }
  }

  $(document).ready(function() {


    //content destinations
    var 
      posts    = $('#posts'),
      pages    = $('#pages'),
      sidebar  = $('#sidebar');

    $.getJSON("index.json").done(function(index){
      _.each(index.pages, expandContent);
      _.each(index.posts, expandContent);

      sidebar.build(function(b){
        b.section(
          {class: 'pages'},
          b.ul(index.pages, function(idx, entry){
            var link = b.a({class: 'loads', href: '#' + entry.slug}, entry.title);
            $.data(link[0], 'entry', entry);
            b.li(link);
          })
        )      
      })

      _.chain(index.posts).groupBy(function(entry){
        return entry.year;
      }).map(function(entries, year){
        return {year: year, entries: entries};
      }).sortBy(function(group){
        return -group.year;
      }).each(function(group){
        var entries = group.entries, year = group.year;
        sidebar.build(function(b){
          b.section({class: 'posts'}, function(){
            b.b(year);
            b.ul(entries, function(idx, entry){
              var id = '#' + entry.slug
              var link = b.a({class: 'loads', href: id}, entry.title);
              $.data(link[0], 'entry', entry);
              b.li(link)
            })
          })
        })
      })

      _.chain(index.pages).each(function(entry){
        pages.build(function(b){
          b.article(
            {id: entry.slug},
            b.h1(entry.title),
            b.section({class: 'body'})
          )            
        })
      })

      _.each(index.posts, function(entry){
        posts.build(function(b){
          b.article(
            {id: entry.slug}, 
            b.span({class: 'date'}, entry.formatDate), 
            entry.tags,
            function(idx, tag){
              b.span({class: 'tag'}, tag);
            },
            b.h1(entry.title), 
            function(x){
              if (entry.subtitle){
                b.p({class: 'subtitle'}, entry.subtitle)
              }
            },
            b.section({class: 'body'}),
            b.section({class: 'comments'})
          )
        })
      })

      $('a.loads').click(function(event){
        event.preventDefault();
        window.location.hash = this.hash;
        $('article').css({display: 'none'})         //conceal all content
        $($(this).attr('href')).css({display: 'block'}) //reveal the select entry
      }).one('click', function(){
        var entry = $.data(this, 'entry');
        entry.load(function(){
          $('#' + entry.slug).find('section.body').append(entry.body).find('pre code').each(function(idx, el) {hljs.highlightBlock(el)})
        })        
      });

      //select most current article
      $('#sidebar .posts a').first().trigger('click')

    });

  });

})();
</script>
</head>  
<body>


<aside id='sidebar'>
  <img id='logo' src='images/bulb.svg'/>
  <h1>Does Ideas</h1>
  <noscript>This site will not be rendered while JavaScript is disabled.</noscript>
</aside>
<section id='main'>
  <section id='pages'></section>
  <section id='posts'></section>
  <section id='comments'>
    <div id='disqus_thread'></div>
  </section>
</section>
<!--script type="text/javascript" src="js/disqus.js"></script-->
</body>
</html>